---
layout: post
title: "Persistent crash of services after TCP SYN scan"
date: 2021-01-20
comments: true
categories: vulnerability
---


## Affected products

We have not yet tested Asus models other than those listed. However we suspect it may also work on other models with the same firmware version.

```
    DSL-N14U_B1 V.1.1.2.3_805
    
```



## Overview

An issue was discovered on ASUS DSL-N14U-B1 1.1.2.3_805 device. Remote attacker to cause a denial of service (crash) by performing a SYN scan using a tool such as nmap. Sending these packets causes a persistent outage of the jetdirect (9100/tcp), LPD (515/tcp) and sos (3838/udp) services. 

## POC

**This PoC can crash services.**

##Stage 1: Enumeration

![](/assets/asus_2/nc_enum.png)


##Stage 2: Upload Test

![](/assets/asus_2/upload_ok.png)


We enter the router via ssh to understand through the proc file system what happens.

![](/assets/asus_2/raw_socket_before.png)

As shown in the figure, we can see some active services and their port in hexadecimal format.
Those that interest us are basically 515 (jetdirect) as well as 0203,
and 515 (LPD) which corresponds to 238C in hexadecimal.

##Stage 3: Send a "ready message"

We run nmap by inserting an additional script with a moderate degree of intrusion.

The script retrieves or sets the ready message on devices that support the Printer Job Language.

sudo nmap -sV --script pjl-ready-message <IP>

Once this is done, we immediately notice differences in the proc file system.

![](/assets/asus_2/raw_socket_after.png)

As a counter check, we show the status of services before and after running nmap via `netstat -tulen`
(busybox doesn't support -p, which is why we work on the proc file system inside the router).

![](/assets/asus_2/netstat_before.png)

![](/assets/asus_2/netstat_after.png)

In the latest two figures we show proc file system effects in a comprehensive way 
![](/assets/asus_2/tcp_udp_all_before.png)

![](/assets/asus_2/tcp_udp_all_after.png)

If we had an eye previously, we have seen well, not just two ocurrencies related ro printing services are deleted...
an additional service crashed: sos service (3838 / tcp) - Scito Object Server

The situation will persist as long as the modem router is active. The services will be active again only with a physical intervention (reboot)


<!--
#Dato il contesto limitante di un ambiente come quello di un router, vi consiglio per "abbellire" il formato del proc file system da questo articolo https://staaldraad.github.io/2017/12/20/netstat-without-netstat/). -->
